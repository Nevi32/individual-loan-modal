<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dairy Goat Loan Simulator | Farmer & Financier Analysis</title>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --cream: #FFF8F0;
            --cream-dark: #F5EDE3;
            --black: #1A1A1A;
            --black-soft: #2A2A2A;
            --accent: #E8DCC8;
            --text-secondary: #666;
            --success: #2D5016;
            --warning: #8B4513;
            --financier: #1A4D2E;
        }

        body {
            font-family: 'Space Grotesk', sans-serif;
            background: var(--cream);
            color: var(--black);
            line-height: 1.6;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
        }

        header {
            text-align: center;
            margin-bottom: 3rem;
            padding: 2rem 0;
            border-bottom: 2px solid var(--black);
        }

        h1 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            letter-spacing: -0.02em;
        }

        .subtitle {
            font-size: 1rem;
            color: var(--text-secondary);
            font-weight: 400;
        }

        .overview {
            background: var(--black);
            color: var(--cream);
            padding: 2rem;
            margin-bottom: 3rem;
            border-radius: 4px;
        }

        .overview h2 {
            font-size: 1.5rem;
            margin-bottom: 1rem;
            font-weight: 600;
        }

        .overview p {
            margin-bottom: 1rem;
            line-height: 1.8;
        }

        .overview-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-top: 1.5rem;
        }

        .overview-item {
            background: var(--black-soft);
            padding: 1.5rem;
            border-radius: 4px;
        }

        .overview-item h3 {
            font-size: 0.875rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--accent);
            margin-bottom: 0.5rem;
            font-weight: 500;
        }

        .main-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            margin-bottom: 3rem;
        }

        .panel {
            background: white;
            padding: 2rem;
            border-radius: 4px;
            border: 1px solid #E5E5E5;
        }

        .panel h2 {
            font-size: 1.25rem;
            margin-bottom: 1.5rem;
            font-weight: 600;
            padding-bottom: 0.75rem;
            border-bottom: 1px solid var(--accent);
        }

        .input-group {
            margin-bottom: 1.5rem;
        }

        label {
            display: block;
            font-size: 0.875rem;
            font-weight: 500;
            margin-bottom: 0.5rem;
            text-transform: uppercase;
            letter-spacing: 0.03em;
        }

        .label-description {
            font-size: 0.75rem;
            color: var(--text-secondary);
            font-weight: 400;
            text-transform: none;
            margin-top: 0.25rem;
            letter-spacing: 0;
        }

        input[type="number"],
        input[type="text"] {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid var(--cream-dark);
            background: var(--cream);
            font-family: 'Space Grotesk', sans-serif;
            font-size: 1rem;
            border-radius: 4px;
            transition: all 0.2s;
        }

        input[type="number"]:focus,
        input[type="text"]:focus {
            outline: none;
            border-color: var(--black);
            background: white;
        }

        .slider-container {
            margin-top: 0.5rem;
        }

        input[type="range"] {
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: var(--cream-dark);
            outline: none;
            -webkit-appearance: none;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--black);
            cursor: pointer;
        }

        input[type="range"]::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--black);
            cursor: pointer;
            border: none;
        }

        .breakdown-table {
            width: 100%;
            margin-top: 1.5rem;
            border-collapse: collapse;
        }

        .breakdown-table th,
        .breakdown-table td {
            padding: 0.75rem;
            text-align: left;
            border-bottom: 1px solid var(--cream-dark);
        }

        .breakdown-table th {
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            font-weight: 600;
            background: var(--cream);
        }

        .breakdown-table td {
            font-size: 0.95rem;
        }

        .breakdown-table tr:last-child td {
            border-bottom: none;
        }

        .button {
            background: var(--black);
            color: var(--cream);
            border: none;
            padding: 0.875rem 2rem;
            font-family: 'Space Grotesk', sans-serif;
            font-size: 0.875rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s;
            margin-top: 1rem;
            width: 100%;
        }

        .button:hover {
            background: var(--black-soft);
            transform: translateY(-1px);
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin: 2rem 0;
        }

        .metric-card {
            background: white;
            padding: 1.5rem;
            border-radius: 4px;
            border: 1px solid #E5E5E5;
            text-align: center;
        }

        .metric-card .label {
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--text-secondary);
            margin-bottom: 0.5rem;
        }

        .metric-card .value {
            font-size: 2rem;
            font-weight: 700;
        }

        .metric-card.farmer {
            background: var(--success);
            color: white;
        }

        .metric-card.farmer .label {
            color: #E8F5E9;
        }

        .metric-card.financier {
            background: var(--financier);
            color: white;
        }

        .metric-card.financier .label {
            color: #E8F5E9;
        }

        .metric-card.warning {
            background: var(--warning);
            color: white;
        }

        .metric-card.warning .label {
            color: #FFF3E0;
        }

        .analysis-section {
            margin: 3rem 0;
        }

        .analysis-section h2 {
            font-size: 1.75rem;
            margin-bottom: 1.5rem;
            font-weight: 700;
        }

        .split-view {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            margin-top: 2rem;
        }

        .value-prop-card {
            background: linear-gradient(135deg, var(--success) 0%, #1A4D2E 100%);
            color: white;
            padding: 2rem;
            border-radius: 4px;
            margin: 2rem 0;
        }

        .value-prop-card h3 {
            font-size: 1.25rem;
            margin-bottom: 1.5rem;
            font-weight: 600;
        }

        .value-prop-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
        }

        .value-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 1rem;
            border-radius: 4px;
        }

        .value-item .label {
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            opacity: 0.8;
            margin-bottom: 0.5rem;
        }

        .value-item .value {
            font-size: 1.5rem;
            font-weight: 700;
        }

        .info-box {
            background: var(--accent);
            padding: 1rem;
            border-radius: 4px;
            margin: 1rem 0;
            font-size: 0.875rem;
        }

        .alert {
            padding: 1rem;
            border-radius: 4px;
            margin: 1rem 0;
            font-size: 0.875rem;
        }

        .alert-success {
            background: #E8F5E9;
            border-left: 4px solid var(--success);
        }

        .alert-warning {
            background: #FFF3E0;
            border-left: 4px solid var(--warning);
        }

        .full-width {
            grid-column: 1 / -1;
        }

        @media (max-width: 968px) {
            .main-grid,
            .split-view {
                grid-template-columns: 1fr;
            }

            h1 {
                font-size: 2rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üêê Dairy Goat Loan Simulator</h1>
            <p class="subtitle">One Farmer One Goat | Complete Financial Analysis for Farmers & Financiers</p>
        </header>

        <div class="overview">
            <h2>About This Simulator</h2>
            <p>This tool analyzes the complete financial picture of dairy goat loans - from both the farmer's perspective (can they afford it and make profit?) and the financier's perspective (what returns are generated?). Adjust parameters to optimize the loan structure for mutual benefit.</p>
            
            <div class="overview-grid">
                <div class="overview-item">
                    <h3>Total Package</h3>
                    <p>Goat + Imfuyo services (shelter, tagging, vet, training, monitoring)</p>
                </div>
                <div class="overview-item">
                    <h3>Farmer Analysis</h3>
                    <p>Monthly cashflow, profitability vs loan payment, break-even timeline</p>
                </div>
                <div class="overview-item">
                    <h3>Financier Analysis</h3>
                    <p>Total interest income, ROI%, margin analysis, risk assessment</p>
                </div>
                <div class="overview-item">
                    <h3>Optimization</h3>
                    <p>Find win-win scenarios that work for both parties</p>
                </div>
            </div>
        </div>

        <div class="main-grid">
            <div class="panel">
                <h2>Loan Parameters</h2>
                
                <div class="input-group">
                    <label>
                        Dairy Goat Price (Kshs)
                        <span class="label-description">Market price of dairy goat</span>
                    </label>
                    <input type="number" id="goatPrice" value="30000" min="10000" max="100000" step="1000">
                    <div class="slider-container">
                        <input type="range" id="goatPriceSlider" min="10000" max="100000" step="1000" value="30000">
                    </div>
                </div>

                <div class="input-group">
                    <label>
                        Imfuyo Services (Kshs)
                        <span class="label-description">Shelter, vet, training, tech</span>
                    </label>
                    <input type="number" id="imfuyoServices" value="11800" min="0" max="20000" step="100">
                </div>

                <div class="input-group">
                    <label>
                        Insurance + Feed (Kshs)
                        <span class="label-description">Livestock insurance & starter feed</span>
                    </label>
                    <input type="number" id="insuranceFeed" value="2000" min="0" max="10000" step="100">
                </div>

                <div class="input-group">
                    <label>
                        Farmer Deposit (%)
                        <span class="label-description">% of goat price paid upfront</span>
                    </label>
                    <input type="number" id="depositPercent" value="30" min="0" max="50" step="5">
                    <div class="slider-container">
                        <input type="range" id="depositPercentSlider" min="0" max="50" step="5" value="30">
                    </div>
                </div>

                <div class="input-group">
                    <label>
                        Monthly Interest Rate (%)
                        <span class="label-description">Flat monthly rate</span>
                    </label>
                    <input type="number" id="monthlyInterest" value="4.5" min="0" max="10" step="0.1">
                    <div class="slider-container">
                        <input type="range" id="monthlyInterestSlider" min="0" max="10" step="0.1" value="4.5">
                    </div>
                </div>

                <div class="input-group">
                    <label>
                        Loan Tenure (Months)
                        <span class="label-description">Repayment period</span>
                    </label>
                    <input type="number" id="tenure" value="12" min="3" max="24" step="1">
                    <div class="slider-container">
                        <input type="range" id="tenureSlider" min="3" max="24" step="1" value="12">
                    </div>
                </div>

                <div class="input-group">
                    <label>
                        Admin Deductible (%)
                        <span class="label-description">Processing fee at disbursement</span>
                    </label>
                    <input type="number" id="deductible" value="4" min="0" max="10" step="0.5">
                </div>

                <h2 style="margin-top: 2rem;">Income Assumptions</h2>

                <div class="input-group">
                    <label>
                        Monthly Milk Income (Kshs)
                        <span class="label-description">Expected milk sales revenue</span>
                    </label>
                    <input type="number" id="milkIncome" value="3200" min="0" max="10000" step="100">
                </div>

                <div class="input-group">
                    <label>
                        Monthly Operating Costs (Kshs)
                        <span class="label-description">Feed, vet, labor, etc.</span>
                    </label>
                    <input type="number" id="operatingCosts" value="0" min="0" max="5000" step="100">
                </div>

                <div class="input-group">
                    <label>
                        Other Monthly Income (Kshs)
                        <span class="label-description">Manure, breeding, kids</span>
                    </label>
                    <input type="number" id="otherIncome" value="0" min="0" max="2000" step="50">
                </div>

                <button class="button" onclick="calculate()">Calculate Full Analysis</button>
            </div>

            <div class="panel">
                <h2>Loan Structure Breakdown</h2>
                
                <table class="breakdown-table">
                    <tr>
                        <th>Component</th>
                        <th>Amount (Kshs)</th>
                    </tr>
                    <tr>
                        <td>Dairy Goat Price</td>
                        <td id="out-goatPrice">30,000</td>
                    </tr>
                    <tr>
                        <td>Imfuyo Services</td>
                        <td id="out-imfuyo">11,800</td>
                    </tr>
                    <tr>
                        <td>Insurance + Feed</td>
                        <td id="out-insuranceFeed">2,000</td>
                    </tr>
                    <tr style="border-top: 2px solid var(--black);">
                        <td><strong>Total Initial</strong></td>
                        <td><strong id="out-totalInitial">43,800</strong></td>
                    </tr>
                    <tr style="background: var(--cream);">
                        <td>Farmer Deposit (30%)</td>
                        <td id="out-deposit">9,000</td>
                    </tr>
                    <tr>
                        <td>Net Financed Balance</td>
                        <td id="out-netBalance">34,800</td>
                    </tr>
                    <tr>
                        <td>Admin Deductible (4%)</td>
                        <td id="out-deductible">1,392</td>
                    </tr>
                    <tr style="background: var(--accent);">
                        <td><strong>Net Disbursed</strong></td>
                        <td><strong id="out-disbursed">33,408</strong></td>
                    </tr>
                    <tr style="margin-top: 1rem;">
                        <td>Total Interest (12mo)</td>
                        <td id="out-interest">18,040</td>
                    </tr>
                    <tr style="background: #E8F5E9;">
                        <td><strong>Total Repayable</strong></td>
                        <td><strong id="out-repayable">51,448</strong></td>
                    </tr>
                    <tr>
                        <td><strong>Monthly Payment</strong></td>
                        <td><strong id="out-monthly">4,287</strong></td>
                    </tr>
                </table>
            </div>
        </div>

        <div class="value-prop-card">
            <h3>üí∞ Value Proposition Summary</h3>
            <div class="value-prop-grid">
                <div class="value-item">
                    <div class="label">Monthly Payment</div>
                    <div class="value" id="vp-payment">4,287</div>
                </div>
                <div class="value-item">
                    <div class="label">Monthly Income</div>
                    <div class="value" id="vp-income">3,200</div>
                </div>
                <div class="value-item">
                    <div class="label">Net Cashflow</div>
                    <div class="value" id="vp-cashflow">-1,087</div>
                </div>
                <div class="value-item">
                    <div class="label">Financier Profit</div>
                    <div class="value" id="vp-financier">19,432</div>
                </div>
                <div class="value-item">
                    <div class="label">ROI for Financier</div>
                    <div class="value" id="vp-roi">58%</div>
                </div>
            </div>
        </div>

        <div class="analysis-section">
            <h2>Detailed Financial Analysis</h2>
            
            <div class="split-view">
                <div class="panel">
                    <h2>üë®‚Äçüåæ Farmer Perspective</h2>
                    
                    <div id="farmerAlert"></div>
                    
                    <div class="metrics-grid" style="grid-template-columns: 1fr;">
                        <div class="metric-card farmer">
                            <div class="label">Monthly Cashflow</div>
                            <div class="value" id="farmer-cashflow">-1,087</div>
                        </div>
                    </div>

                    <table class="breakdown-table">
                        <tr>
                            <td>Monthly Income (all sources)</td>
                            <td id="farmer-totalIncome">3,200</td>
                        </tr>
                        <tr>
                            <td>Monthly Loan Payment</td>
                            <td id="farmer-payment">4,287</td>
                        </tr>
                        <tr>
                            <td>Monthly Operating Costs</td>
                            <td id="farmer-costs">0</td>
                        </tr>
                        <tr style="border-top: 2px solid var(--black);">
                            <td><strong>Net Monthly Cashflow</strong></td>
                            <td><strong id="farmer-net">-1,087</strong></td>
                        </tr>
                        <tr>
                            <td>Total Cashflow (loan period)</td>
                            <td id="farmer-totalCashflow">-13,048</td>
                        </tr>
                        <tr>
                            <td>Total Income (loan period)</td>
                            <td id="farmer-periodIncome">38,400</td>
                        </tr>
                        <tr>
                            <td>Total Paid to Financier</td>
                            <td id="farmer-totalPaid">51,448</td>
                        </tr>
                        <tr style="background: var(--accent);">
                            <td><strong>Net Position After Loan</strong></td>
                            <td><strong id="farmer-netPosition">-13,048</strong></td>
                        </tr>
                    </table>
                </div>

                <div class="panel">
                    <h2>üè¶ Financier Perspective</h2>
                    
                    <div id="financierAlert"></div>
                    
                    <div class="metrics-grid" style="grid-template-columns: 1fr;">
                        <div class="metric-card financier">
                            <div class="label">Total Profit</div>
                            <div class="value" id="financier-profit">19,432</div>
                        </div>
                    </div>

                    <table class="breakdown-table">
                        <tr>
                            <td>Amount Disbursed</td>
                            <td id="financier-disbursed">33,408</td>
                        </tr>
                        <tr>
                            <td>Admin Fee Collected</td>
                            <td id="financier-adminFee">1,392</td>
                        </tr>
                        <tr>
                            <td>Total Interest Income</td>
                            <td id="financier-interest">18,040</td>
                        </tr>
                        <tr>
                            <td>Total Collected from Farmer</td>
                            <td id="financier-collected">51,448</td>
                        </tr>
                        <tr style="border-top: 2px solid var(--black); background: #E8F5E9;">
                            <td><strong>Gross Profit</strong></td>
                            <td><strong id="financier-grossProfit">19,432</strong></td>
                        </tr>
                        <tr>
                            <td>Return on Disbursed Amount</td>
                            <td id="financier-roi">58.2%</td>
                        </tr>
                        <tr>
                            <td>Monthly Margin</td>
                            <td id="financier-monthlyMargin">4.85%</td>
                        </tr>
                        <tr>
                            <td>Effective APR</td>
                            <td id="financier-apr">54.0%</td>
                        </tr>
                    </table>
                </div>
            </div>
        </div>

        <div class="panel full-width">
            <h2>Optimization Recommendations</h2>
            <div id="recommendations"></div>
        </div>
    </div>

    <script>
        function linkInputSlider(inputId, sliderId) {
            const input = document.getElementById(inputId);
            const slider = document.getElementById(sliderId);
            
            input.addEventListener('input', () => {
                slider.value = input.value;
                calculate();
            });
            
            slider.addEventListener('input', () => {
                input.value = slider.value;
                calculate();
            });
        }

        linkInputSlider('goatPrice', 'goatPriceSlider');
        linkInputSlider('depositPercent', 'depositPercentSlider');
        linkInputSlider('monthlyInterest', 'monthlyInterestSlider');
        linkInputSlider('tenure', 'tenureSlider');

        ['imfuyoServices', 'insuranceFeed', 'deductible', 'milkIncome', 'operatingCosts', 'otherIncome'].forEach(id => {
            document.getElementById(id).addEventListener('input', calculate);
        });

        function formatCurrency(value) {
            return new Intl.NumberFormat('en-KE', {
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            }).format(value);
        }

        function calculate() {
            // Get inputs
            const goatPrice = parseFloat(document.getElementById('goatPrice').value) || 0;
            const imfuyoServices = parseFloat(document.getElementById('imfuyoServices').value) || 0;
            const insuranceFeed = parseFloat(document.getElementById('insuranceFeed').value) || 0;
            const depositPercent = parseFloat(document.getElementById('depositPercent').value) || 0;
            const monthlyInterestRate = parseFloat(document.getElementById('monthlyInterest').value) / 100 || 0;
            const tenure = parseInt(document.getElementById('tenure').value) || 12;
            const deductiblePercent = parseFloat(document.getElementById('deductible').value) / 100 || 0;
            
            const milkIncome = parseFloat(document.getElementById('milkIncome').value) || 0;
            const operatingCosts = parseFloat(document.getElementById('operatingCosts').value) || 0;
            const otherIncome = parseFloat(document.getElementById('otherIncome').value) || 0;

            // Loan calculations
            const totalInitial = goatPrice + imfuyoServices + insuranceFeed;
            const farmerDeposit = (goatPrice * depositPercent) / 100;
            const netFinancedBalance = totalInitial - farmerDeposit;
            const adminDeductible = netFinancedBalance * deductiblePercent;
            const netDisbursed = netFinancedBalance - adminDeductible;

            const totalInterest = netDisbursed * monthlyInterestRate * tenure;
            const totalRepayable = netDisbursed + totalInterest;
            const monthlyPayment = totalRepayable / tenure;
            const apr = (monthlyInterestRate * 12) * 100;

            // Update loan structure
            document.getElementById('out-goatPrice').textContent = formatCurrency(goatPrice);
            document.getElementById('out-imfuyo').textContent = formatCurrency(imfuyoServices);
            document.getElementById('out-insuranceFeed').textContent = formatCurrency(insuranceFeed);
            document.getElementById('out-totalInitial').textContent = formatCurrency(totalInitial);
            document.getElementById('out-deposit').textContent = formatCurrency(farmerDeposit);
            document.getElementById('out-netBalance').textContent = formatCurrency(netFinancedBalance);
            document.getElementById('out-deductible').textContent = formatCurrency(adminDeductible);
            document.getElementById('out-disbursed').textContent = formatCurrency(netDisbursed);
            document.getElementById('out-interest').textContent = formatCurrency(totalInterest);
            document.getElementById('out-repayable').textContent = formatCurrency(totalRepayable);
            document.getElementById('out-monthly').textContent = formatCurrency(monthlyPayment);

            // Farmer analysis
            const totalMonthlyIncome = milkIncome + otherIncome;
            const netMonthlyCashflow = totalMonthlyIncome - monthlyPayment - operatingCosts;
            const totalPeriodIncome = totalMonthlyIncome * tenure;
            const totalPeriodCosts = operatingCosts * tenure;
            const totalCashflow = netMonthlyCashflow * tenure;
            const netPositionAfterLoan = totalPeriodIncome - totalPeriodCosts - totalRepayable;

            document.getElementById('farmer-totalIncome').textContent = formatCurrency(totalMonthlyIncome);
            document.getElementById('farmer-payment').textContent = formatCurrency(monthlyPayment);
            document.getElementById('farmer-costs').textContent = formatCurrency(operatingCosts);
            document.getElementById('farmer-net').textContent = formatCurrency(netMonthlyCashflow);
            document.getElementById('farmer-cashflow').textContent = formatCurrency(netMonthlyCashflow);
            document.getElementById('farmer-totalCashflow').textContent = formatCurrency(totalCashflow);
            document.getElementById('farmer-periodIncome').textContent = formatCurrency(totalPeriodIncome);
            document.getElementById('farmer-totalPaid').textContent = formatCurrency(totalRepayable);
            document.getElementById('farmer-netPosition').textContent = formatCurrency(netPositionAfterLoan);

            // Farmer alert
            const farmerAlert = document.getElementById('farmerAlert');
            if (netMonthlyCashflow >= 0) {
                farmerAlert.innerHTML = `
                    <div class="alert alert-success">
                        <strong>‚úì Viable for Farmer!</strong> Positive monthly cashflow of Kshs ${formatCurrency(netMonthlyCashflow)}.
                    </div>
                `;
            } else {
                farmerAlert.innerHTML = `
                    <div class="alert alert-warning">
                        <strong>‚ö† Negative Cashflow</strong> Farmer loses Kshs ${formatCurrency(Math.abs(netMonthlyCashflow))} per month. Need more income or better terms.
                    </div>
                `;
            }

            // Financier analysis
            const grossProfit = adminDeductible + totalInterest;
            const roi = (grossProfit / netDisbursed) * 100;
            const monthlyMargin = monthlyInterestRate * 100;

            document.getElementById('financier-disbursed').textContent = formatCurrency(netDisbursed);
            document.getElementById('financier-adminFee').textContent = formatCurrency(adminDeductible);
            document.getElementById('financier-interest').textContent = formatCurrency(totalInterest);
            document.getElementById('financier-collected').textContent = formatCurrency(totalRepayable);
            document.getElementById('financier-grossProfit').textContent = formatCurrency(grossProfit);
            document.getElementById('financier-profit').textContent = formatCurrency(grossProfit);
            document.getElementById('financier-roi').textContent = roi.toFixed(1) + '%';
            document.getElementById('financier-monthlyMargin').textContent = monthlyMargin.toFixed(2) + '%';
            document.getElementById('financier-apr').textContent = apr.toFixed(1) + '%';

            // Value proposition
            document.getElementById('vp-payment').textContent = formatCurrency(monthlyPayment);
            document.getElementById('vp-income').textContent = formatCurrency(totalMonthlyIncome);
            document.getElementById('vp-cashflow').textContent = formatCurrency(netMonthlyCashflow);
            document.getElementById('vp-financier').textContent = formatCurrency(grossProfit);
            document.getElementById('vp-roi').textContent = roi.toFixed(0) + '%';

            // Financier alert
            const financierAlert = document.getElementById('financierAlert');
            financierAlert.innerHTML = `
                <div class="alert alert-success">
                    <strong>‚úì Profitable</strong> Total profit of Kshs ${formatCurrency(grossProfit)} with ${roi.toFixed(1)}% ROI.
                </div>
            `;

            // Recommendations
            const recommendations = document.getElementById('recommendations');
            let recoText = '<div class="info-box">';
            
            if (netMonthlyCashflow < 0) {
                recoText += '<h3 style="margin-bottom: 1rem;">‚ö†Ô∏è Loan Not Viable for Farmer</h3>';
                recoText += '<p><strong>Options to improve:</strong></p>';
                recoText += '<ul style="margin-left: 2rem; margin-top: 0.5rem;">';
                
                // Calculate what's needed
                const incomeNeeded = monthlyPayment + operatingCosts;
                const incomeGap = incomeNeeded - totalMonthlyIncome;
                
                recoText += `<li>Increase income by Kshs ${formatCurrency(incomeGap)}/month to break even</li>`;
                
                // Try longer tenure
                const newTenure = Math.ceil((totalRepayable / (totalMonthlyIncome - operatingCosts)));
                if (newTenure > tenure && newTenure <= 24) {
                    recoText += `<li>Extend tenure to ${newTenure} months (new monthly payment: Kshs ${formatCurrency(totalRepayable / newTenure)})</li>`;
                }
                
                // Try higher deposit
                const targetPayment = totalMonthlyIncome - operatingCosts;
                if (targetPayment > 0) {
                    const targetRepayable = targetPayment * tenure;
                    const targetDisbursed = targetRepayable / (1 + (monthlyInterestRate * tenure));
                    const targetFinanced = targetDisbursed / (1 - deductiblePercent);
                    const targetDeposit = totalInitial - targetFinanced;
                    const targetDepositPercent = (targetDeposit / goatPrice) * 100;
                    
                    if (targetDepositPercent >= 0 && targetDepositPercent <= 50) {
                        recoText += `<li>Increase deposit to ${targetDepositPercent.toFixed(0)}% (Kshs ${formatCurrency(targetDeposit)})</li>`;
                    }
                }
                
                recoText += '</ul>';
            } else {
                recoText += '<h3 style="margin-bottom: 1rem;">‚úì Mutually Beneficial Loan</h3>';
                recoText += `<p><strong>Farmer:</strong> Earns Kshs ${formatCurrency(netMonthlyCashflow)}/month positive cashflow during loan period</p>`;
                recoText += `<p><strong>Financier:</strong> Earns Kshs ${formatCurrency(grossProfit)} profit (${roi.toFixed(1)}% ROI)</p>`;
                
                if (roi > 70) {
                    recoText += `<p style="margin-top: 1rem; color: var(--warning);"><strong>Note:</strong> ROI of ${roi.toFixed(1)}% is quite high. Consider lowering interest rate to be more farmer-friendly while maintaining profitability.</p>`;
                }
            }
            
            recoText += '</div>';
            recommendations.innerHTML = recoText;
        }

        // Initial calculation
        calculate();
    </script>
</body>
</html>
